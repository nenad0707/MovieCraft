@inject AuthenticationStateProvider AuthenticationStateProvider
@inject PopularMoviesState PopularMoviesState

<CascadingAuthenticationState>
    @if (isSplashVisible)
    {
        <SplashScreen />
    }
    else
    {
        <Router AppAssembly="@typeof(App).Assembly">
            <Found Context="routeData">
                <AuthorizeRouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)">
                    <NotAuthorized>
                        <RedirectToLogin />
                    </NotAuthorized>
                </AuthorizeRouteView>
            </Found>
            <NotFound>
                <PageTitle>Not found</PageTitle>
                <LayoutView Layout="@typeof(MainLayout)">
                    <p role="alert">We're sorry, this address does not exist.</p>
                </LayoutView>
            </NotFound>
        </Router>
    }
</CascadingAuthenticationState>

@code {
    private bool isSplashVisible = true;

    [Inject]
    private NavigationManager? NavigationManager { get; set; }


    protected override async Task OnInitializedAsync()
    {
        try
        {
            var loadTask = PopularMoviesState.LoadPopularMoviesAsync();
           
            
            var delayTask = Task.Delay(2000);

            await Task.WhenAll(loadTask, delayTask);

            isSplashVisible = false;


        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading data: {ex.Message}");
            isSplashVisible = false;
        }
    }
}
